#include "i2c_lib.h"

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_init(I2C_HandleType *I2Cx, void(*func_delay_us)(uint32_t delay), uint32_t(*func_time_handle)(void))
{
	return i2c_msw_init(I2Cx, func_delay_us, func_time_handle);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_deinit(I2C_HandleType *I2Cx)
{
	return i2c_msw_deinit(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明: 返回的是应答信号
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_start(I2C_HandleType *I2Cx, uint8_t is_write)
{
	//---发送启动信号
	i2c_msw_start(I2Cx);
	//---判断是读取操作还是写入操作
	if (is_write)
	{
		I2Cx->msg_addr &= 0xFE;
	}
	else
	{
		I2Cx->msg_addr |= 0x01;
	}
	//---发送从机地址
	i2c_msw_send_byte(I2Cx, (uint8_t)I2Cx->msg_addr);
	//---读取应答信号
	return i2c_msw_read_ack(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_stop(I2C_HandleType *I2Cx)
{
	//---发送启动信号
	return	i2c_msw_stop(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_ack(I2C_HandleType *I2Cx)
{
	return i2c_msw_ack(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_nack(I2C_HandleType *I2Cx)
{
	return i2c_msw_nack(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_read_ack(I2C_HandleType *I2Cx)
{
	return i2c_msw_read_ack(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_wait_ack(I2C_HandleType *I2Cx)
{
	return i2c_msw_wait_ack(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_send_ack(I2C_HandleType *I2Cx, uint8_t is_nack)
{
	return i2c_msw_send_ack(I2Cx, is_nack);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_send_byte(I2C_HandleType *I2Cx, uint8_t buffer)
{
	return i2c_msw_send_byte(I2Cx, buffer);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_send_word(I2C_HandleType *I2Cx, uint16_t buffer)
{
	return  i2c_msw_send_word(I2Cx, buffer);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_read_byte(I2C_HandleType *I2Cx)
{
	return i2c_msw_read_byte(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_check_device(I2C_HandleType *I2Cx)
{
	return i2c_msw_check_device(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_send_cmd(I2C_HandleType *I2Cx, uint8_t cmd, uint8_t is_start, uint8_t is_stop)
{
	return i2c_msw_send_cmd(I2Cx, cmd, is_start, is_stop);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_data_send(I2C_HandleType *I2Cx, uint8_t *buffer, int16_t length)
{
	uint8_t _return = OK_0;
	int16_t i = 0;

	//---发送启动信号并发送从机地址---写地址
	_return = i2c_lib_msw_start(I2Cx, 1);

	//---判断启动信号是否成功并同时决定是否发送数据
	if (_return == 0)
	{
		for (i = 0; i < length; i++)
		{
			//---发送数据
			i2c_lib_msw_send_byte(I2Cx, buffer[i]);

			//---读取应答信号
			_return = i2c_lib_msw_read_ack(I2Cx);

			//---判断应答信号
			if (_return)
			{
				_return = (2 + i);
				break;
			}
		}
	}
	return _return;
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_msw_data_read(I2C_HandleType *I2Cx, uint8_t *buffer, int16_t length)
{
	uint8_t _return = OK_0;
	int16_t i = 0;

	//---发送启动信号并发送从机地址---写地址
	_return = i2c_lib_msw_start(I2Cx, 1);

	//---判断启动信号是否成功并同时决定是否发送数据
	if (_return != OK_0)
	{
		goto GotoExit;
	}

	//---发送启动信号并发送从机地址---读取地址
	_return = i2c_lib_msw_start(I2Cx, 0);

	//---判断启动信号是否成功并同时决定是否发送数据
	if (_return != OK_0)
	{
		_return = ERROR_2;
		goto GotoExit;
	}
	for (i = 0; i < length; i++)
	{
		//---读取数据
		buffer[i] = i2c_lib_msw_read_byte(I2Cx);
		if ((length - 1) == i)
		{
			_return = ERROR_3;
		}

		//---发送应答信号或则不应答信号
		i2c_lib_msw_send_ack(I2Cx, _return);
	}
	_return = OK_0;
GotoExit:
	return _return;
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参数:
//////输出参数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
uint8_t i2c_lib_master_deinit(I2C_HandleType* I2Cx)
{
	return i2c_master_deinit(I2Cx);
}

///////////////////////////////////////////////////////////////////////////////
//////函		数:
//////功		能:
//////输入参	数:
//////输出参	数:
//////说		明:
//////////////////////////////////////////////////////////////////////////////
void i2c_lib_time_tick_init(I2C_HandleType* I2Cx, uint32_t(*func_time_handle)(void))
{
	i2c_time_tick_init(I2Cx, func_time_handle);
}
